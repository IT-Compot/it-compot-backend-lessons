# Введение в БД и административную панель Django

### Будем начинать мини-проект **Блог**

---

## Начало

1. **Создайте новое приложение `blog`**

    ```bash
    python manage.py startapp blog
    ```

    ➔ Объясняем, что эта команда создаёт структуру папок и файлов, необходимых для работы нового модуля в проекте Django.

2. **Разница между проектом и приложением в Django**

    - **Проект** — это "основа сайта", каркас, который объединяет всё в одну большую систему.
    - **Приложение** — это отдельный модуль с чёткой функциональностью, например блог, магазин, форум и т.д.
    - В проекте может быть **много приложений**, каждое из которых отвечает за свою задачу.

3. **Что такое база данных?**

    - База данных — это система для хранения информации в удобном формате.
    - Веб-сайтам нужно хранить информацию о пользователях, товарах, постах и другом.
    - База данных позволяет быстро искать, добавлять, изменять и удалять данные.

4. **Как Django взаимодействует с базой данных SQLite3**

    - По умолчанию Django использует лёгкую встроенную базу данных **SQLite3**.
    - Она хранит данные в одном файле (`db.sqlite3`) в корне проекта.
    - Django с помощью моделей автоматически генерирует таблицы и работает с ними через ORM (Object Relational Mapping) — вместо SQL-запросов мы пишем Python-код.

5. **Показываем вспомогательный раздел**

    ➔ Показываем и комментируем материал [Создание модели товара](https://github.com/xlartas/it-compot-backend-methods/blob/main/django-base.md#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%B9%D1%88%D0%B5%D0%B9-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-%D0%B4%D0%BB%D1%8F-%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0).

---

## Модели

1. **Создаём первую модель поста**

    ```python
    # blog/models.py
    from django.db import models

    class Post(models.Model):
        title = models.CharField(max_length=70)
        text = models.TextField()
    ```

    ➔ Объясняем:
    - Класс `Post` описывает, как будет выглядеть таблица в БД.
    - `CharField` — для короткого текста (заголовок).
    - `TextField` — для длинного текста (сам пост).

2. **Создание миграций**

    ```bash
    python manage.py makemigrations
    ```

    ➔ Django создаёт файл-инструкцию, что и как нужно изменить в базе данных.

3. **Выполнение миграций**

    ```bash
    python manage.py migrate
    ```

    ➔ Реальные изменения применяются к базе данных, создаётся таблица для модели `Post`.

4. **Установим расширение SQLite Viewer**

    ➔ Это плагин для VS Code, чтобы смотреть содержимое базы данных прямо в редакторе.

5. **Что произошло в базе данных**

    ➔ Показываем файл `db.sqlite3` и таблицу, созданную для модели `Post`.

6. **Административная панель Django**

    - Это удобный встроенный инструмент для управления данными через браузер.
    - Позволяет добавлять, редактировать, удалять записи без написания кода.

7. **Регистрируем модель в админке**

    ```python
    # blog/admin.py
    from django.contrib import admin
    from .models import Post

    @admin.register(Post)
    class PostAdmin(admin.ModelAdmin):
        list_display = ('title', 'text')
    ```

    ➔ Объясняем:
    - Мы говорим Django, что хотим видеть модель `Post` в панели администратора.
    - `list_display` настраивает отображаемые столбцы.

8. **Создаём администратора**

    ```bash
    python manage.py createsuperuser
    ```

    ➔ Создаём учётку администратора для входа в `/admin/`.

9. **Создаём посты через админку**

    ➔ Заходим в `/admin/`, создаём записи для проверки, что всё работает.

10. **Делаем модель более интересной**

    ```python
    class Post(models.Model):
        title = models.CharField(max_length=70)
        image = models.ImageField(upload_to='images/')
        text = models.TextField()
        likes = models.IntegerField(blank=True)
        rating = models.FloatField(blank=True)
        is_published = models.BooleanField(default=True)
        created_at = models.DateTimeField(auto_now_add=True)
    ```

    ➔ Объясняем:
    - `ImageField` — для загрузки изображений (обязательно установить библиотеку Pillow).
    - `IntegerField`, `FloatField` — числовые поля.
    - `BooleanField` — для отметки публикации поста.
    - `DateTimeField` — автоматически фиксирует дату создания.

    ➔ Не забываем:
    - Создать миграции после изменений (`makemigrations`, `migrate`).
    - Показать ошибку о Pillow, объяснить, как исправить:

    ```bash
    pip install Pillow
    ```

11. **Что такое медиафайлы**

    - Изображения и другие загружаемые пользователем файлы — это **медиа**.
    - Чтобы Django умел показывать медиафайлы, нужно правильно настроить `MEDIA_URL` и `MEDIA_ROOT`.

12. **Настраиваем сохранение медиафайлов**

    В `settings.py`:

    ```python
    MEDIA_URL = '/media/'
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
    ```

    В `urls.py`:

    ```python
    from django.conf import settings
    from django.conf.urls.static import static

    urlpatterns = [
        # другие маршруты
    ]

    if settings.DEBUG:
        urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
    ```

    ➔ Объясняем:
    - `MEDIA_URL` — через какой путь будут доступны файлы в браузере.
    - `MEDIA_ROOT` — куда сохранять загруженные файлы на сервере.

---

## Итоги занятия

- Поняли, что такое база данных и зачем она нужна.
- Создали приложение и подключили его к проекту.
- Описали первую модель и сделали миграции.
- Настроили административную панель Django.
- Научились загружать изображения и работать с медиафайлами.

---
